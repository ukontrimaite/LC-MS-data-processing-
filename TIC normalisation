# Load necessary library
library(data.table)

# Define file paths
data_path <- "/Users/unek/Desktop/ecm_gin_ha_total_for_pqn.csv"  # Input file
output_path <- "/Users/unek/Desktop/normalized_tic.csv"  # Output file

# Load dataset
data <- fread(data_path, header = TRUE, stringsAsFactors = FALSE, check.names = FALSE)

# Extract sample labels
sample_labels <- data[[1]]  # Assume first column contains sample labels
features <- data[, -1, with = FALSE]  # Exclude sample labels

# Compute Total Ion Count (TIC) for each sample
tic_values <- rowSums(features, na.rm = TRUE)

# Normalize each sample by its TIC
normalized_features <- features / tic_values

# Add sample labels back
normalized_data <- cbind(Sample = sample_labels, normalized_features)

# Save the normalized data
fwrite(normalized_data, output_path, row.names = FALSE)

cat("TIC normalization completed and saved to:", output_path)
